<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Politický kompas 2025 | Volební kalkulačka</title>
    <meta name="description" content="3D politický kompas českých stran pro volby 2025">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/css/style-ankap.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Matching main page color scheme */
            --color-primary: #FFD93D;
            --color-secondary: #FFF200;
            --color-bg-dark: #0A0A0A;
            --color-bg-darker: #000000;
            --color-text: #FFFFFF;
            --color-text-muted: #CCCCCC;
            --color-text-dark: #999999;
            --border: #333;
            
            /* Compass specific */
            --color-bg-secondary: rgba(0, 0, 0, 0.3);
            --color-bg-tertiary: rgba(0, 0, 0, 0.2);
            --color-border: rgba(255, 217, 61, 0.15);
            
            /* Aliases for compatibility */
            --bg-primary: var(--color-bg-dark);
            --bg-secondary: var(--color-bg-darker);
            --text-primary: var(--color-text);
            --text-secondary: var(--color-text-muted);
            --accent: var(--color-primary);
        }
        
        /* Light theme variables */
        .theme-light {
            --color-primary: #E6B800;
            --color-secondary: #D4AF00;
            --color-bg-dark: #FFFFFF;
            --color-bg-darker: #F5F5F5;
            --color-text: #1A1A1A;
            --color-text-muted: #4A4A4A;
            --color-text-dark: #666666;
            
            /* Compass specific - light backgrounds */
            --color-bg-secondary: rgba(240, 240, 240, 0.95);
            --color-bg-tertiary: rgba(248, 248, 248, 0.95);
            --color-border: rgba(200, 200, 200, 0.3);
            
            /* Update aliases */
            --bg-primary: var(--color-bg-dark);
            --bg-secondary: var(--color-bg-darker);
            --text-primary: var(--color-text);
            --text-secondary: var(--color-text-muted);
            --accent: var(--color-primary);
        }
        
        body {
            background: var(--color-bg-dark);
            color: var(--color-text);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .theme-light body {
            background: var(--color-bg-dark);
            color: var(--color-text);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        /* Header */
        .header-sticky {
            position: sticky;
            top: 0;
            background: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        
        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: var(--color-primary);
        }
        
        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            padding-bottom: 2px;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--color-primary);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--text-primary);
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        /* Theme Toggle - matching main page */
        .theme-toggle {
            width: 44px;
            height: 44px;
            border: 2px solid var(--text-secondary);
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            margin-left: 1rem;
        }
        
        .theme-toggle:hover {
            border-color: var(--accent);
        }
        
        .theme-toggle-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        /* Dark theme - white circle */
        .theme-dark .theme-toggle-icon {
            background: #FFFFFF;
        }
        
        /* Light theme - black circle */
        .theme-light .theme-toggle-icon {
            background: #000000;
        }
        
        /* Mobile Menu Button */
        .mobile-menu-button {
            display: none;
            flex-direction: column;
            gap: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
        }
        
        .mobile-menu-button span {
            width: 24px;
            height: 2px;
            background: var(--text-primary);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            
            .mobile-menu-button {
                display: flex;
            }
        }
        
        /* Compass Section */
        .compass-hero {
            padding: 1.5rem 0 3rem;
            background: var(--color-bg-dark);
            min-height: 100vh;
        }
        
        .compass-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .compass-header h2 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            color: var(--color-text);
        }
        
        .compass-header p {
            font-size: 1rem;
            color: var(--color-text-muted);
            margin-bottom: 0;
        }
        
        .compass-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 1.5rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding: 1.5rem;
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 12px;
        }
        
        .compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .compass-title {
            font-size: 0.95rem;
            margin-bottom: 1.2rem;
            text-align: center;
            font-weight: 500;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .compass-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 500px;
            margin: 0 auto;
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            overflow: visible;
        }
        
        .compass {
            position: absolute;
            top: 40px;
            left: 40px;
            right: 40px;
            bottom: 40px;
        }
        
        .axis {
            position: absolute;
            background: rgba(255, 217, 61, 0.4);
        }
        
        .axis.horizontal {
            top: 50%;
            left: 5%;
            right: 5%;
            height: 1px;
            background: rgba(255, 217, 61, 0.15);
        }
        
        .axis.vertical {
            left: 50%;
            top: 5%;
            bottom: 5%;
            width: 1px;
            background: rgba(255, 217, 61, 0.15);
        }
        
        .axis-label {
            position: absolute;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: var(--color-bg-secondary);
            padding: 0.3rem 0.6rem;
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }
        
        .axis-label-top { 
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%); 
        }
        
        .axis-label-bottom { 
            bottom: 15px; 
            left: 50%; 
            transform: translateX(-50%); 
        }
        
        .axis-label-left { 
            left: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
        }
        
        .axis-label-right { 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
        }
        
        .axis-icon {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Party dots */
        .party {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 1px 3px rgba(0,0,0,0.5),
                inset 0 1px 1px rgba(255,255,255,0.15);
            z-index: 10;
        }
        
        .party:hover,
        .party.highlight {
            transform: translate(-50%, -50%) scale(1.5);
            z-index: 100;
            border-color: rgba(255, 217, 61, 0.8);
            box-shadow: 
                0 3px 8px rgba(0,0,0,0.7),
                0 0 0 2px rgba(255, 217, 61, 0.3),
                0 0 12px currentColor;
        }
        
        .party-label {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-bg-darker);
            color: var(--color-text);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(255, 217, 61, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9);
        }
        
        .party:hover .party-label,
        .party.highlight .party-label {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }
        
        /* Party colors */
        .party.ano { background: #261060; }
        .party.spolu { background: #004494; }
        .party.stan { background: #5d5cae; }
        .party.stacilo { background: #f44336; }
        .party.pirati { background: #000000; }
        .party.spd { background: #ea3838; }
        .party.prisaha { background: #0033a0; }
        .party.motoriste { background: #1f3a93; }
        .party.socdem { background: #ff6600; }
        .party.trikolora { background: #004bff; }
        .party.svobodni { background: #009682; }
        .party.zeleni { background: #00a651; }
        .party.pro { background: #4caf50; }
        .party.volt { background: #502379; }
        .party.levice { background: #d50000; }
        .party.koruna { background: #c9302c; }
        .party.pravy_blok { background: #1976d2; }
        .party.urza { background: #616161; }
        .party.rovne_sance { background: #ff4500; }
        .party.nekorupce { background: #4169e1; }
        .party.budoucnost { background: #32cd32; }
        .party.europa { background: #1e90ff; }
        .party.csi { background: #dc143c; }
        .party.prameny { background: #8b4513; }
        .party.ne_eu { background: #8b0000; }
        .party.konzervativni { background: #191970; }
        .party.ceska_pravice { background: #000080; }
        .party.jasan { background: #daa520; }
        .party.tpk { background: #b22222; }
        .party.voluntia { background: #ffeb3b; color: #333; }
        .party.sms { background: #ff5722; }
        .party.normalni { background: #4682B4; }
        .party.kdu-csl { background: #FFD700; }
        .party.ods { background: #0056A7; }
        .party.top09 { background: #7C3590; }
        .party.kscm { background: #8b0000; }
        .party.cssd { background: #ff4500; }
        .party.mzh { background: #8B4513; }
        .party.kruh { background: #2E8B57; }
        .party.generace { background: #4B0082; }
        .party.rebelove { background: #FF4500; }
        .party.vyzva2025 { background: #20B2AA; }
        .party.gen2025 { background: #9370DB; }
        .party.pravy-blok { background: #000080; }
        .party.republika { background: #B22222; }
        .party.levy-blok { background: #8B0000; }
        .party.narodni-demokracie { background: #4B0082; }
        .party.pravo-respekt { background: #696969; }
        .party.aliance-stabilita { background: #483D8B; }
        .party.ceska-suverenita { background: #8B4513; }
        .party.volt { background: #502379; }
        .party.budoucnost { background: #32CD32; }
        .party.jasan { background: #DAA520; }
        .party.voluntia { background: #FFD700; }
        
        /* Legend */
        .legend-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--color-bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--color-border);
        }
        
        .legend-title {
            font-size: 1.4rem;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 600;
            color: var(--color-primary);
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.6rem 1.2rem;
            align-items: start;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding: 0.5rem 0.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            min-height: 36px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .legend-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .legend-item:hover span {
            color: var(--color-primary);
        }
        
        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: static !important;
            transform: none !important;
        }
        
        .legend-item:hover .legend-dot {
            transform: scale(1.3);
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.7),
                0 0 8px currentColor;
        }
        
        .legend-item span {
            font-weight: 500;
            font-size: 0.75rem;
            color: var(--color-text);
            line-height: 1.3;
            word-break: break-word;
            overflow-wrap: break-word;
            flex: 1;
        }
        
        /* Responsive Design */
        @media (max-width: 1400px) {
            .legend-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 1200px) {
            .compass-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
                max-width: 700px;
            }
            
            .compass-wrapper {
                height: 500px;
            }
            
            .legend-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .compass-grid {
                padding: 1rem;
            }
            
            .compass-wrapper {
                height: 450px;
            }
            
            .compass-header h2 {
                font-size: 1.8rem;
            }
            
            .legend-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
                gap: 0.5rem 1.5rem;
            }
            
            .legend-item {
                padding: 0.4rem;
                min-height: 32px;
            }
            
            .legend-item span {
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 600px) {
            .legend-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 0.4rem 1rem;
            }
            
            .legend-item {
                padding: 0.5rem;
            }
        }
        
        /* Center point */
        .compass-wrapper::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: rgba(255, 217, 61, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
        
        /* User position marker */
        .user-position {
            position: absolute;
            width: 24px;
            height: 24px;
            background: var(--color-primary);
            border: 3px solid #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            box-shadow: 
                0 0 0 2px var(--color-primary),
                0 4px 12px rgba(0,0,0,0.8),
                0 0 20px rgba(255, 217, 61, 0.8);
            animation: pulse-user 2s ease-in-out infinite;
        }
        
        .user-position::before {
            content: 'TY';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: bold;
            color: #000;
        }
        
        @keyframes pulse-user {
            0%, 100% { 
                box-shadow: 
                    0 0 0 2px var(--color-primary),
                    0 4px 12px rgba(0,0,0,0.8),
                    0 0 20px rgba(255, 217, 61, 0.8);
            }
            50% { 
                box-shadow: 
                    0 0 0 4px var(--color-primary),
                    0 4px 16px rgba(0,0,0,0.9),
                    0 0 30px rgba(255, 217, 61, 1.0);
            }
        }
        
        
        /* Footer */
        .footer {
            padding: 3rem 0 2rem;
            border-top: 1px solid var(--border);
            margin-top: 5rem;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 3rem;
        }
        
        .footer-main h4 {
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }
        
        .footer-content {
            color: var(--color-text-muted);
        }
    </style>
</head>
<body class="theme-dark">
    <!-- Header -->
    <header class="header-sticky">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>A kdo by stavěl silnice?</h1>
                </div>
                <nav class="nav">
                    <a href="index-ankap.html" class="nav-link">Domů</a>
                    <a href="index-ankap.html#jak-to-funguje" class="nav-link">Jak to funguje</a>
                    <a href="index-ankap.html#kalkulacka" class="nav-link">Kalkulačka</a>
                    <a href="index-ankap.html#metodologie" class="nav-link">Metodologie</a>
                    <a href="index-ankap.html#faq" class="nav-link">FAQ</a>
                    <a href="compass.html" class="nav-link">Politický kompas</a>
                    <a href="https://kdobystavelsilnice.cz" class="nav-link" target="_blank">Blog</a>
                    <button class="theme-toggle" id="themeToggle" aria-label="Přepnout téma">
                        <span class="theme-toggle-icon"></span>
                    </button>
                </nav>
                <button class="mobile-menu-button" aria-label="Menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Compass Section -->
    <section class="compass-hero">
        <div class="container">
            <div class="compass-header">
                <h2>3D Politický kompas českých stran</h2>
                <p>Vizualizace pozic českých stran na třech politických osách</p>
            </div>
            
            <div class="compass-grid">
                <!-- Main compass: Economic vs Social -->
                <div class="compass-container">
                    <h3 class="compass-title">Ekonomická × Sociální</h3>
                    <div class="compass-wrapper">
                        <div class="compass" id="compass-main">
                            <div class="axis horizontal"></div>
                            <div class="axis vertical"></div>
                        </div>
                        <div class="axis-label axis-label-top">
                            <span class="axis-icon">🏳️‍🌈</span>
                            <span>Progres</span>
                        </div>
                        <div class="axis-label axis-label-bottom">
                            <span class="axis-icon">⛪</span>
                            <span>Tradice</span>
                        </div>
                        <div class="axis-label axis-label-left">
                            <span class="axis-icon">🏛️</span>
                            <span>Stát</span>
                        </div>
                        <div class="axis-label axis-label-right">
                            <span class="axis-icon">💰</span>
                            <span>Trh</span>
                        </div>
                    </div>
                </div>
                
                <!-- Secondary compass: Economic vs Sovereignty -->
                <div class="compass-container">
                    <h3 class="compass-title">Ekonomická × Suverenitní</h3>
                    <div class="compass-wrapper">
                        <div class="compass" id="compass-sovereignty">
                            <div class="axis horizontal"></div>
                            <div class="axis vertical"></div>
                        </div>
                        <div class="axis-label axis-label-top">
                            <span class="axis-icon">🇪🇺</span>
                            <span>Evropská</span>
                        </div>
                        <div class="axis-label axis-label-bottom">
                            <span class="axis-icon">🇨🇿</span>
                            <span>Národní</span>
                        </div>
                        <div class="axis-label axis-label-left">
                            <span class="axis-icon">🏛️</span>
                            <span>Stát</span>
                        </div>
                        <div class="axis-label axis-label-right">
                            <span class="axis-icon">💰</span>
                            <span>Trh</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="legend-section">
                <h3 class="legend-title">Politické strany</h3>
                <div class="legend-grid" id="legend"></div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-main">
                    <h4>A kdo by stavěl silnice?</h4>
                    <p>3D Politický kompas 2025</p>
                </div>
                <div class="footer-disclaimer">
                    <p><small>
                        Pozice stran vycházejí z analýzy volebních programů a veřejných postojů.
                        Vizualizace je orientační a zjednodušuje komplexní politické reality.
                    </small></p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mark current page as active in navigation
        document.addEventListener('DOMContentLoaded', function() {
            const compassLink = document.querySelector('.nav-link[href="compass.html"]');
            if (compassLink) {
                compassLink.classList.add('active');
            }
        });
        
        // Fallback party data for local testing - all 26 parties
        const fallbackParties = [
            {code: "ANO", name: "ANO", compass_position: {EKO: -0.36, SOC: 0.23, SUV: 0.41}},
            {code: "SPOLU", name: "SPOLU", compass_position: {EKO: 0.64, SOC: -0.05, SUV: -0.64}},
            {code: "SPD", name: "SPD", compass_position: {EKO: -0.41, SOC: 0.86, SUV: 0.82}},
            {code: "PIRATI", name: "Piráti", compass_position: {EKO: -0.32, SOC: -0.95, SUV: -0.68}},
            {code: "STAN", name: "STAN", compass_position: {EKO: 0.14, SOC: -0.18, SUV: -0.73}},
            {code: "KSČM", name: "KSČM", compass_position: {EKO: -0.95, SOC: 0.23, SUV: 0.73}},
            {code: "TRIKOLORA", name: "Trikolóra", compass_position: {EKO: 0.77, SOC: 0.82, SUV: 0.68}},
            {code: "PRISAHA", name: "Přísaha", compass_position: {EKO: 0.23, SOC: 0.27, SUV: 0.09}},
            {code: "SOCDEM", name: "SOCDEM", compass_position: {EKO: -0.68, SOC: -0.55, SUV: -0.36}},
            {code: "ZELENI", name: "Zelení", compass_position: {EKO: -0.50, SOC: -1.00, SUV: -1.00}},
            {code: "SVOBODNI", name: "Svobodní", compass_position: {EKO: 0.95, SOC: -0.45, SUV: 0.36}},
            {code: "MOTORISTE", name: "Motoristé", compass_position: {EKO: 0.55, SOC: 0.32, SUV: 0.50}},
            {code: "PRO", name: "PRO", compass_position: {EKO: 0.32, SOC: 0.41, SUV: 0.64}},
            {code: "REPUBLIKA", name: "REPUBLIKA", compass_position: {EKO: 0.27, SOC: 0.82, SUV: 0.68}},
            {code: "STACILO", name: "Stačilo!", compass_position: {EKO: -0.95, SOC: -0.45, SUV: 0.41}},
            {code: "VYZVA2025", name: "Výzva2025", compass_position: {EKO: 0.00, SOC: 0.14, SUV: 0.14}},
            {code: "KRUH", name: "KRUH", compass_position: {EKO: 0.00, SOC: -0.45, SUV: -0.18}},
            {code: "VOLUNTIA", name: "VOLUNTIA", compass_position: {EKO: 1.00, SOC: -0.73, SUV: -0.09}},
            {code: "BUDOUCNOST", name: "Budoucnost", compass_position: {EKO: -0.32, SOC: -0.50, SUV: -0.64}},
            {code: "JASAN", name: "JASAN", compass_position: {EKO: 0.55, SOC: 0.36, SUV: 0.23}},
            {code: "LEVY_BLOK", name: "Levý blok", compass_position: {EKO: -1.00, SOC: -0.91, SUV: 0.09}},
            {code: "NARODNI_DEMOKRACIE", name: "Národní demokracie", compass_position: {EKO: 0.27, SOC: 0.86, SUV: 0.77}},
            {code: "PRAVO_RESPEKT", name: "Právo Respekt", compass_position: {EKO: 0.00, SOC: 0.00, SUV: 0.00}},
            {code: "ALIANCE_STABILITA", name: "Aliance pro stabilitu", compass_position: {EKO: -0.18, SOC: 0.23, SUV: 0.09}},
            {code: "CESKA_SUVERENITA", name: "Česká suverenita", compass_position: {EKO: 0.27, SOC: 0.59, SUV: 0.73}},
            {code: "VOLT", name: "Volt", compass_position: {EKO: -0.05, SOC: -0.86, SUV: -1.00}}
        ];
        
        // Load party positions from API
        fetch('/.netlify/functions/api-parties')
            .then(response => {
                if (!response.ok) throw new Error('API not available');
                return response.json();
            })
            .then(data => {
                const parties = {};
                data.forEach(party => {
                    parties[party.code] = {
                        ...party.compass_position,
                        name: party.name
                    };
                });
                
                // Place parties on compasses (3D system uses EKO, SOC, SUV)
                placeParties('compass-main', 'EKO', 'SOC', parties);
                placeParties('compass-sovereignty', 'EKO', 'SUV', parties);
                
                // Try to load and display user position from localStorage
                loadUserPosition();
                
                // Create legend
                createLegend(parties);
                
                // Setup hover interactions
                setupInteractions();
            })
            .catch(error => {
                console.error('Error loading party data, using fallback:', error);
                // Use fallback data when API is not available
                const parties = {};
                fallbackParties.forEach(party => {
                    parties[party.code] = {
                        ...party.compass_position,
                        name: party.name
                    };
                });
                
                // Place parties on compasses (3D system uses EKO, SOC, SUV)
                placeParties('compass-main', 'EKO', 'SOC', parties);
                placeParties('compass-sovereignty', 'EKO', 'SUV', parties);
                
                // Try to load and display user position from localStorage
                loadUserPosition();
                
                // Create legend
                createLegend(parties);
                
                // Setup hover interactions
                setupInteractions();
            });
        
        function placeParties(compassId, xDimension, yDimension, parties) {
            const compass = document.getElementById(compassId);
            const compassRect = compass.getBoundingClientRect();
            const compassWidth = compassRect.width;
            const compassHeight = compassRect.height;
            const centerX = compassWidth / 2;
            const centerY = compassHeight / 2;
            
            // Scale to use most of the compass area - slightly smaller for clarity
            const scaleX = (compassWidth * 0.9);
            const scaleY = (compassHeight * 0.9);
            
            // Track positioned parties to handle overlapping
            const positionedParties = [];
            
            Object.entries(parties).forEach(([code, data]) => {
                let x = centerX + (data[xDimension] * scaleX / 2);
                let y = centerY + (data[yDimension] * scaleY / 2); // Y axis now correctly oriented
                
                // Anti-collision: slightly adjust position if too close to existing parties
                const minDistance = 20;
                let attempts = 0;
                let adjusted = false;
                
                while (attempts < 12) {
                    const collision = positionedParties.find(pos => {
                        const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                        return distance < minDistance;
                    });
                    
                    if (!collision) break;
                    
                    // Spiral outward from original position with better distribution
                    const angle = (attempts * 30) * (Math.PI / 180);
                    const offset = 8 + (attempts * 2);
                    x = centerX + (data[xDimension] * scaleX / 2) + Math.cos(angle) * offset;
                    y = centerY + (data[yDimension] * scaleY / 2) + Math.sin(angle) * offset;
                    attempts++;
                    adjusted = true;
                }
                
                positionedParties.push({ x, y, code });
                
                const party = document.createElement('div');
                const cssClass = code.toLowerCase().replace(/_/g, '-');
                party.className = `party ${cssClass}`;
                party.setAttribute('data-party-code', code);
                party.style.left = `${x}px`;
                party.style.top = `${y}px`;
                party.style.transform = 'translate(-50%, -50%)';
                
                // Add slight random rotation for visual interest
                if (adjusted) {
                    party.style.animationDelay = `${Math.random() * 0.5}s`;
                }
                
                const label = document.createElement('div');
                label.className = 'party-label';
                label.textContent = data.name;
                party.appendChild(label);
                
                compass.appendChild(party);
            });
        }
        
        function createLegend(parties) {
            const legend = document.getElementById('legend');
            
            // Sort parties alphabetically
            const sortedParties = Object.entries(parties).sort((a, b) => 
                a[1].name.localeCompare(b[1].name, 'cs')
            );
            
            sortedParties.forEach(([code, data]) => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.setAttribute('data-party-code', code);
                
                const dot = document.createElement('div');
                const cssClass = code.toLowerCase().replace(/_/g, '-');
                dot.className = `legend-dot party ${cssClass}`;
                
                const name = document.createElement('span');
                name.textContent = data.name;
                
                item.appendChild(dot);
                item.appendChild(name);
                legend.appendChild(item);
            });
        }
        
        function setupInteractions() {
            // Hover effects for legend items
            document.querySelectorAll('.legend-item').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    const code = this.getAttribute('data-party-code');
                    document.querySelectorAll(`.party[data-party-code="${code}"]`).forEach(party => {
                        party.classList.add('highlight');
                    });
                });
                
                item.addEventListener('mouseleave', function() {
                    const code = this.getAttribute('data-party-code');
                    document.querySelectorAll(`.party[data-party-code="${code}"]`).forEach(party => {
                        party.classList.remove('highlight');
                    });
                });
            });
        }
        
        function loadUserPosition() {
            // Check if we have user compass data from calculator
            const userCompass = localStorage.getItem('userCompassPosition');
            if (userCompass) {
                try {
                    const position = JSON.parse(userCompass);
                    console.log('Loading user position:', position);
                    
                    // Place user position on both compasses
                    placeUserPosition('compass-main', 'EKO', 'SOC', position);
                    placeUserPosition('compass-sovereignty', 'EKO', 'SUV', position);
                } catch (e) {
                    console.error('Error loading user position:', e);
                }
            }
        }
        
        function placeUserPosition(compassId, xDimension, yDimension, position) {
            const compass = document.getElementById(compassId);
            const compassRect = compass.getBoundingClientRect();
            const compassWidth = compassRect.width;
            const compassHeight = compassRect.height;
            const centerX = compassWidth / 2;
            const centerY = compassHeight / 2;
            
            // Use same scaling as parties
            const scaleX = (compassWidth * 0.85);
            const scaleY = (compassHeight * 0.85);
            
            const x = centerX + (position[xDimension] * scaleX / 2);
            const y = centerY + (position[yDimension] * scaleY / 2);
            
            // Remove existing user position
            const existingUser = compass.querySelector('.user-position');
            if (existingUser) {
                existingUser.remove();
            }
            
            // Create user position marker
            const userMarker = document.createElement('div');
            userMarker.className = 'user-position';
            userMarker.style.left = `${x}px`;
            userMarker.style.top = `${y}px`;
            
            // Add tooltip showing exact position
            const tooltip = document.createElement('div');
            tooltip.className = 'party-label';
            tooltip.textContent = `Vaše pozice: EKO:${position.EKO.toFixed(2)} ${yDimension}:${position[yDimension].toFixed(2)}`;
            tooltip.style.opacity = '0';
            userMarker.appendChild(tooltip);
            
            userMarker.addEventListener('mouseenter', function() {
                tooltip.style.opacity = '1';
                tooltip.style.transform = 'translateX(-50%) translateY(-4px)';
            });
            
            userMarker.addEventListener('mouseleave', function() {
                tooltip.style.opacity = '0';
                tooltip.style.transform = 'translateX(-50%)';
            });
            
            compass.appendChild(userMarker);
        }
        
        // Theme switching functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Check for saved theme preference or default to 'dark'
        const currentTheme = localStorage.getItem('theme') || 'dark';
        body.className = `theme-${currentTheme}`;
        
        themeToggle?.addEventListener('click', function() {
            const currentTheme = body.classList.contains('theme-dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.className = `theme-${newTheme}`;
            localStorage.setItem('theme', newTheme);
            
            // Update CSS variables for light theme - using same system as main page
            if (newTheme === 'light') {
                document.documentElement.style.setProperty('--color-bg-dark', '#ffffff');
                document.documentElement.style.setProperty('--color-bg-darker', '#f5f5f5');
                document.documentElement.style.setProperty('--color-text', '#1a1a1a');
                document.documentElement.style.setProperty('--color-text-muted', '#4a4a4a');
                document.documentElement.style.setProperty('--color-primary', '#e6b800');
            } else {
                document.documentElement.style.setProperty('--color-bg-dark', '#0a0a0a');
                document.documentElement.style.setProperty('--color-bg-darker', '#000000');
                document.documentElement.style.setProperty('--color-text', '#ffffff');
                document.documentElement.style.setProperty('--color-text-muted', '#cccccc');
                document.documentElement.style.setProperty('--color-primary', '#ffd93d');
            }
        });
        
        // Check for user position updates from parent window (if opened from calculator)
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'userCompassPosition') {
                console.log('Received user position from calculator:', event.data.position);
                localStorage.setItem('userCompassPosition', JSON.stringify(event.data.position));
                
                // Place user position immediately
                placeUserPosition('compass-main', 'EKO', 'SOC', event.data.position);
                placeUserPosition('compass-sovereignty', 'EKO', 'SUV', event.data.position);
            }
        });
    </script>
</body>
</html>